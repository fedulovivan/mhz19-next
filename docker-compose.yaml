x-logging: &default-logging
    driver: json-file
    options:
        max-size: 50m
        max-file: 5
        compress: 1

services:
    device-pinger:
        build:
            context: ../device-pinger
        image: "device-pinger"
        env_file: ".env"
        restart: unless-stopped
        logging: *default-logging
        depends_on:
            - "mosquitto"
        # network_mode: "host"
    backend:
        build:
            context: "."
        image: "mhz19-next"
        env_file: ".env"
        # map sound devices to enable mp3 playback from containers
        devices:
            - "/dev/snd:/dev/snd"
        volumes:
            - "./database.bin:/app/database.bin"
        depends_on:
            - "mosquitto"
        restart: unless-stopped
        logging: *default-logging
        # network_mode: "host"
    zigbee2mqtt:
        image: koenkk/zigbee2mqtt
        ports:
            - 7000:7000
        volumes:
            - ./zigbee2mqtt-data:/app/data
        devices:
            - "/dev/ttyUSB0:/dev/ttyUSB0"
        depends_on:
            - "mosquitto"
        restart: unless-stopped
        logging: *default-logging
    mosquitto:
        image: eclipse-mosquitto
        volumes:
            - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
            - ./mosquitto.passwd:/etc/mosquitto/passwd
        ports:
            - 1883:1883
        restart: unless-stopped
        logging: *default-logging    
